========
工作流程
========

在 Jam.py 框架中，同时运行着两个任务：应用程序构建器
和项目。
每个任务都代表一个对象树——有应用程序构建器任务树
和项目任务树。因此，在了解 Jam.py 工作流程之前，
您需要先熟悉 
:doc:`任务树 <task_tree>`
的概念。

Jam.py 的工作流程如下：

* 当运行 server.py 时，它会创建 WSGI 应用程序，而该应用程序又会
  创建应用程序构建器任务树。
* 项目任务树由应用程序构建器在服务器端创建，当
  服务器收到来自项目客户端的第一个请求时。为此，
  应用程序构建器使用存储在项目根文件夹中的 admin.sqlite 数据库中的元数据。
  创建任务树后，服务器应用程序会触发
  :doc:`on_created </refs/server/task/on_created>`
  事件，该事件可用于初始化服务器任务树。
* 当客户端应用程序（应用程序构建器或项目）首次在浏览器中运行
  （加载 ``builder.html`` 或 ``index.html`` 后），会
  构建一个空的任务对象，该对象向服务器发送请求以初始化自身。
* 如果项目的
  :doc:`安全模式 </admin/project/parameters>`
  参数已设置，框架在执行任何请求之前会检查用户是否已登录。
  如果未登录，则
  客户端应用程序会创建登录表单，用户输入其
  用户名和密码后，客户端任务会向服务器发送登录请求。
* 登录成功后，或者如果项目的
  :doc:`安全模式 </admin/project/parameters>`
  参数未设置，服务器会向客户端发送有关
  所请求任务的信息。客户端的任务根据此
  信息构建其树，为其对象分配事件处理程序，并执行
  :doc:`on_page_loaded </refs/client/task/on_page_loaded>`
  事件处理程序。
* 在此事件处理程序中，开发人员应将 JQuery 事件处理程序函数
  附加到 ``index.html`` 文件中定义的 DOM 的 HTML 元素。
  在这些函数中，开发人员可以使用
  :doc:`任务树 <task_tree>`
  项目的方法来执行某些特定任务。
  这些方法在执行时，会触发不同的事件，在这些事件中可以调用其他方法，
  依此类推。请参阅
  :doc:`客户端编程 <interface/index>`。
* 任务树中具有对应数据库表的项目，有方法
  可以在服务器数据库中读取和写入数据。请参阅
  :doc:`数据编程 <data/index>`。
* 报告项目基于 LibreOffice 模板在服务器上生成报告。请参阅
  :doc:`报告编程 <reports/index>`。
* 所有其方法生成对服务器的请求的项目，都以
  以下方式执行：它们调用任务的方法，向服务器发送任务的
  :doc:`ID </refs/client/abstr_item/at_id>`
  和项目的
  :doc:`ID </refs/client/abstr_item/at_id>`
  请求类型及其参数。
  服务器收到请求后，根据传递的 ID，找到服务器上的任务
  （可以是项目任务或应用程序构建器任务）和项目，
  使用传递的参数执行相应方法，并将执行结果
  返回给客户端。这些服务器方法可能会触发它们自己的
  事件，这些事件可以覆盖默认行为。请参阅
  :doc:`服务器端编程 <server/index>`。

视频
=====

`Form events`_ 和 `Client-server interactions`_ 视频教程说明了
Jam.py 项目的工作流程。

.. _`Form events`: https://youtu.be/DY463lcv0R4

.. _`Client-server interactions`: https://youtu.be/nLOhdA2FX0I
