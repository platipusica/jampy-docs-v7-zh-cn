=======
数据集
=======

Jam.py 框架使用的数据集概念非常接近
`Embarcadero Delphi`_ 的数据集。

.. _Embarcadero Delphi: https://en.wikipedia.org/wiki/Delphi_(programming_language)

.. note::

    还有其他读取和修改数据库数据的方法。您可以使用
    任务的 :doc:`connect </refs/server/task/m_connect>` 
    方法从连接池获取连接，并使用
    该连接通过 Python Database API 访问数据库。

所有 ``item_type`` 为 "item" 或 "table" 的项目以及它们的明细表（参见
:doc:`任务树 </programming/task_tree>`）
都可以从项目数据库的关联表中访问数据并写入
更改。它们都是 Item 类的对象

* :doc:`Item 类 </refs/client/item_api>`（在客户端）
* :doc:`Item 类 </refs/server/item_api>`（在服务器端）

这两个类具有与数据处理相关的相同属性、方法和事件。

要从项目数据集表中获取数据集（一组记录），请使用 open
方法。此方法根据参数生成 SQL 查询以获取
数据集。

数据集打开后，应用程序可以浏览它、更改其记录或
插入新记录，并将更改写入项目的数据库表。

例如，以下函数将把 *support_rep_id* 字段值设置为
客户端和服务器上 *id* 字段的值：

.. code-block:: js

    function set_support_id(customers) {
        customers.open();
        while (!customers.eof()) {
            customers.edit();
            customers.support_rep_id.value = customers.id.value;
            customers.post();
            customers.next();
        }
        customers.apply();
    }

.. code-block:: py

    def set_support_id(customers):
        customers.open()
        while not customers.eof():
            customers.edit()
            customers.support_rep_id.value = customers.id.value
            customers.post()
            customers.next()
        customers.apply();

这些函数将 **customers** （客户）项目作为参数。然后使用 *open*
方法从客户表中获取记录列表，并修改每条
记录。最后，使用 apply 方法将更改保存在数据库表中（参见
:doc:`修改数据集 <modifying_datasets>`
）。

.. note::

    有一种更简短的浏览数据集的方法（参见
    :doc:`浏览数据集 <navigating_datasets>`
    ）。例如，在 Python 中，以下循环是等效的：
    
    .. code-block:: py
    
        while not customers.eof():
            print customers.firstname.value
            customers.next()
        
        for c in customers:
            print c.firstname.value

视频
======

`Datasets`_ 和 `Datasets Part 2`_ 通过具体示例演示了几乎所有的数据集操作方法。

.. _`Datasets`: https://youtu.be/gHTYj7h9ljI
.. _`Datasets Part 2`: https://youtu.be/1bUGmgBfrNw
