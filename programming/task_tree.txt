=========
任务树
=========

框架的所有对象都表示为一个对象树。这些对象被称为项目。

树中的所有项目都有一个共同的祖先类 ``AbstractItem`` (
:doc:`客户端参考 </refs/client/abstractitem_api>`
/
:doc:`服务器端参考 </refs/server/abstractitem_api>`
)，并具有以下共同属性：

* ``ID`` - 项目中在框架内唯一的 ID
	
* ``owner`` - 项目的直接父级和所有者
	
* ``task`` - 任务树的根节点
	
* ``items`` - 子项目列表
	
* ``item_type`` - 项目类型
      
* ``item_name`` - 项目的名称，将在编程代码中用于访问该项目

* ``item_caption`` - 向用户显示的项目名称 树的根节点是任务项目。

任务包含组项目。组有三种类型，它们的 ``item_type`` 属性具有以下值：

* "journals" - 这些组包含 ``item_type`` 为"item"的项目，这些项目可以有关联的数据库表。
 
* "catalogs" - 这类组也包含可以有关联数据库表的项目，但它们可用于为其他项目创建明细表（参见
  :doc:`明细表 <data/details>`
  ）。

* "reports" - 这些组包含报告 - ``item_type`` 为"report"的项目，
  用于创建报告。

组的数量没有限制。我们建议为组使用逻辑名称，因为该名称用于下拉菜单。

可以有关联数据库表的项目可以拥有明细表，用于存储属于主表记录的记录。

例如，
:doc:`演示项目 </intro/demo_project>`
的任务树为：::

    /demo/
        catalogs/
           customers 
           tracks/
                invoice_table           
           albums
           artists
           genres
           mail
        journals/
            invoices/
                invoice_table
            invoices_client/
                invoice_table
        details/
            invoice_table
        reports/
            invoice
            purchases_report
        analytics
        system
        

任务树的根节点是一个 ``item_name`` 为 **demo** 的任务。它有
五个组：**catalogs**、**journals**、**details**、**reports**、**analytics** 
和 **system**。
**catalogs** 和 **journals** 组的 ``item_type`` 为"items"。它们所拥有的项目
是对应数据库表的包装器。有一个明细表项目，其 ``item_name`` 为 **invoice_table**，
它也有自己的数据库表，而 **reports** 组中有三个报告。

**invoices** 日志拥有 **invoice_table** 明细表，用于保存客户发票中的曲目列表。
因此，有三个同名的"invoice_table"项目：Details Group 中的明细表、
Journal/Invoices 的明细表以及 Catalogs/Tracks 的明细表。

每个项目都是其所有者的属性，所有项目、表和报告也都是
任务的属性（它们都有唯一的 ``item_name``）。

在客户端，任务是一个全局对象。要访问它，只需在代码中的任何位置输入 ``task``。

在服务器端，任务不是全局的。Jam.py 是一个事件驱动的环境。
每个事件都有一个参数，即触发该事件的项目（或字段）。
在项目的服务器模块中定义的函数可以通过 
:doc:`server </refs/client/abstr_item/m_server>`
方法从客户端模块执行，这些函数的第一个参数也是相应的项目。

了解一个项目后，我们就可以访问任务树中的任何其他项目。例如，要
访问 **customers** 目录，我们可以这样写：

.. code-block:: js

  def on_apply(item, delta, params): 
      customers = item.task.catalogs.customers.copy()


或者直接写：

.. code-block:: js

  def on_apply(item, delta, params): 
      customers = item.task.customers.copy()


项目的层次结构是框架 DRY 
（不要重复自己）原则的基础之一。

例如，项目的一些方法在执行时，会依次为任务、组和项目生成事件。

这样，我们就可以在任务的事件处理程序中为所有项目定义基本行为，
这些行为可以在组的事件处理程序中扩展，最后，
如有必要，可以在项目本身的事件处理程序中具体指定。更多
详细信息，请参阅
:doc:`表单事件 <interface/form_events>`

视频
=====

`Task tree`_ 视频教程使用
:doc:`演示项目 </intro/demo_project>`
演示了任务树。

.. _`Task tree`: https://youtu.be/hsSKqEh6vL4
